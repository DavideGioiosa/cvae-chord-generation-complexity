<p align="center"><img width="150" src="https://camo.githubusercontent.com/7bc40fff3c166508ead40e4ec7354e4d616bdd1a7733941d2ae75a154668958d/68747470733a2f2f63646e2e737461746963616c6c792e696f2f696d672f706e67696d6167652e6e65742f77702d636f6e74656e742f75706c6f6164732f323031382f30362f706f6c697465636e69636f2d6d696c616e6f2d6c6f676f2d706e672d352e706e67"></p>

# Modeling Harmonic Complexity in Automatic Music Generation using Conditional Variational Autoencoders

Author: [@DavideGioiosa](https://github.com/DavideGioiosa)

## Main Technologies
- Python 3.7
- Tensorflow/Keras
- Pandas, Numpy, Matplotlib
- Flask, AWS
- MIDI, .wav

## Goal 

Is it possible to use complexity as a parameter to automatically generate music? This is the question that motivates our research. In the area of automatic music composition, several neural network models have been implemented to generate music of a certain musical genre _e.g. rock, pop, jazz_, or to capture and imitate the style of a composer.
Recent studies in this area of research, focus on providing the ability not only to generate music, but also to be able to condition the creative process.

> From previous researches we know that complexity is a parameter closely related to the amount of brain activity of the listener (the so-called "arousal potential"). It also affects a person's musical preferences. Given this close correlation with a listener's perceptions, we decide to explore the use of this parameter in music.

Complexity is present in each of the aspects in which the music can be divided, e.g. chords, rhythm, melody, etc. Among these we choose to focus on the harmony. In particular, in this work we explore **Harmonic Complexity** and its use as a parameter to condition the generation of chord sequences. 

For the automatic generation process we exploit **two Conditional Neural Network** models both based on the **Variational Autoencoder** (VAE). We evaluated, through a perceptual test, the ability to generate chord sequences give a desired complexity values. 

## Dataset

The starting dataset used for this experimental thesis comes from this research: _[A Data-Driven Model of Tonal Chord Sequence Complexity](https://www.researchgate.net/publication/320029367_A_Data-Driven_Model_of_Tonal_Chord_Sequence_Complexity)_, containing 5-chord sequences associated with a complexity bin. We represent each chord by a multi-hot vector:

<p align="center"><img width="300" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/chord_multi_hot_vector.png"></p>

## Conditional Variational Autoencoder
The Conditional Variational Autoencoder (CVAE) is an extension of the VAE model and it's a type of Conditional Architectures. They are a type of Neural Networks characterized by the addition of the conditioning feature as an extra input layer to the network model. This model provides the possibility of having control over the data during the generation process through the conditioning with the target feature. In this research the harmonic complexity is the parameter used to condition the VAE.
<p align="center"><img width="450" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/Conditional_VAE.png" ></p>


_In the next section the two implemented models are simply described, more information on their mathematical formulation is available in the thesis._

### Model A
This first model of CVAE incorporates the conditioning information by concatenating the complexity vector as input the encoder and the decoder.
<p align="center"><img width="450" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/CVAE_1.png"></p>

### Model B
This second model of CVAE is composed by the combination of the standard VAE with a Regressor (RVAE), which explicitly condition the distribution of the data in the latent space with respect to the harmonic complexity.
<p align="center"><img width="450" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/RVAE.png"></p>

This is achieved by linking the latent representation of the input chord sequence with the associated harmonic complexity in the model structure: on one hand, the latent representations generated by the Regressor prediction must resemble the latent representation of the input, and on the other hand, the variation relative to the harmonic complexity in the latent space is encouraged to follow a direction defined by the dissociated dimension. 
We obtained a disentangled dimension in the latent representation encoding harmonic complexity: variations along one dimension are explained by this feature, while they are relatively invariant to variations in other factors.
<p align="center"><img width="250" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/RVAE_latent_space.png"></p>

### Generation of new chord progressions
The two trained CVAE can generate new chord sequences with the desired harmonic complexity.
<p align="center"><img width="450" src="https://github.com/DavideGioiosa/master-thesis-polimi/blob/master/Img/CVAEs_generation.png"></p>

Examples of generating chord sequences using harmonic complexity with the CVAE and RVAE models are provided in the two _.ipynb_ files in symbolic, midi and wav formats.

### Listening Test  
A web-app has been designed using **Flask** and **AWS** to collect ratings on the generated chord sequences. In the fist part of the experiment, the participants are profied based on their music background using the self-report questionnaire of the _[Goldsmiths Musical Sophistication Index](https://www.gold.ac.uk/music-mind-brain/gold-msi/)_. The second part is the perceptual test in which the participants were asked to express their level of agreement to the indicated complexity value provided for each chord progressions. The evaluation is expressed using the Likert scale scores from 0 to 4, where completely agree is the highest score and completely disagree the lowest one.

## Research Article 
The article of this research is published in _EURASIP Journal on Audio, Speech, and Music Processing_; more information and the results of the different experiments are available in the [Article](https://asmp-eurasipjournals.springeropen.com/?gclid=Cj0KCQjwu-KiBhCsARIsAPztUF3Lfscl9Ji7vS_UIeDo-V6NU1amXCl7maKgKmxnIL2I1PKGx3UGwssaAiYtEALw_wcB).

Further examples of the outputs of the models are available on this [Website](https://lucacoma.github.io/vae_complexity_website/).
